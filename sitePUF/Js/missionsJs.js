$(document).ready(function(){function t(){if(s()){idEnseignant=null;idChargeTD=null;typeEvaluation=null;if($("#lstEnseignant option:selected").attr("data-id")!=null)idEnseignant=$("#lstEnseignant option:selected").attr("data-id");if($("#lstChargeTD option:selected").attr("data-id")!=null)idChargeTD=$("#lstChargeTD option:selected").attr("data-id");if($("#lstTypeEvaluation option:selected").val()!="")typeEvaluation=$("#lstTypeEvaluation option:selected").val();if($("#lstSemestre option:selected").attr("data-id")=="1")idModule=$("#lstModuleS1 option:selected").attr("data-id");if($("#lstSemestre option:selected").attr("data-id")=="2")idModule=$("#lstModuleS2 option:selected").attr("data-id");$.ajax({url:"./createMission",data:"title="+$("#titleMission").val()+"&start="+$("#startMission").val().split("/").reverse().join("-")+"&end="+$("#endMission").val().split("/").reverse().join("-")+"&fiche="+$("#ficheMission").val()+"&bgColor="+$("#bgColorMission").val()+"&txtColor="+$("#txtColorMission").val()+"&idModule="+idModule+"&idFormation="+$("#lstFormation option:selected").attr("data-id")+"&typeEval="+typeEvaluation+"&coefEval="+$("#coefEvaluation").val()+"&dateEval="+$("#dateEvaluation").val().split("/").reverse().join("-")+"&idEnseignant="+idEnseignant+"&idChargeTD="+idChargeTD+"&fonction=addMission",type:"POST"}).done(function(){$("#missionContent").dialog("close");$("#calendar").fullCalendar("refetchEvents")})}}function n(){$("#missionContent input, #missionContent select ").prop("disabled",false);$("#divBgColorMission, #divTxtColorMission").prop("hidden",false);$("#divIdMission, #divIdEvaluation").prop("hidden",true);$("#txtColorMission, #bgColorMission").prop("disabled",true);$(".require").prop("hidden",false);$(".noValid").empty()}function r(){$("#missionContent input, #missionContent select ").val("");$("#missionContent input, #missionContent select ").prop("disabled",true);$("#divBgColorMission, #divTxtColorMission").prop("hidden",true);$("#divIdMission, #divIdEvaluation").prop("hidden",false);$("#divModSemestre1, #divModSemestre2").prop("hidden",false);$("#infoEvaluation").prop("hidden",false);$(".require").prop("hidden",true)}function i(e){e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);return"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2)}function s(){var e=true;$(".noValid").empty();if($("#titleMission").val()==""){e=false;$("#titleMission").next(".noValid").text("Veuillez indiquer un titre pour la mission")}if($("#startMission").val()==""||$("#startMission").val().length!=10){e=false;$("#startMission").next(".noValid").text("Veuillez entrer une date valide")}if($("#endMission").val()==""||$("#endMission").val().length!=10){e=false;$("#endMission").next(".noValid").text("Veuillez entrer une date valide")}if($("#endMission").val()!=""&&$("#startMission").val()!=""){if(!o()){e=false;$("#endMission").next(".noValid").text("Date début >= Date fin ou problème avec l'année")}}if($("#lstFormation option:selected").attr("value")==""){e=false;$("#lstFormation").next(".noValid").text("Veuillez choisir une formation")}if($("#lstSemestre option:selected").attr("value")==""){e=false;$("#lstSemestre").next(".noValid").text("Veuillez choisir un semestre")}else{if($("#lstSemestre option:selected").attr("data-id")=="1"){if($("#lstModuleS1 option:selected").attr("value")==""){e=false;$("#lstModuleS1").next(".noValid").text("Veuillez choisir un module")}}if($("#lstSemestre option:selected").attr("data-id")=="2"){if($("#lstModuleS2 option:selected").attr("value")==""){e=false;$("#lstModuleS2").next(".noValid").text("Veuillez choisir un module")}}}return e}function o(){var e=true;var t=$("#startMission").val().substring(6,10);var n=$("#startMission").val().substring(3,5);var r=$("#startMission").val().substring(0,2);var i=$("#endMission").val().substring(6,10);var s=$("#endMission").val().substring(3,5);var o=$("#endMission").val().substring(0,2);if(t>i){e=false}else{if(t==i&&n>s){e=false}else{if(t==i&&(n=s)&&r>=o){e=false}}}var u=new Date;if(t>2100||i>2100||t<u.getFullYear()-2){e=false}return e}$("#startMission").datepicker();$("#endMission").datepicker();$("#dateEvaluation").datepicker();var e=$("#calendar").fullCalendar({header:{left:"prev",center:"title",right:"next"},defaultDate:moment(),lang:"fr",theme:true,events:{url:"./getMissions",type:"POST"},editable:true,eventRender:function(e,t){t.click(function(){$.ajax({url:"./detailsMission",data:"id="+e.id,type:"POST",dataType:"json"}).done(function(e){$("#idMission").val(e.idMission);$("#titleMission").val(e.title);$("#startMission").val(moment(e.start).format("DD/MM/YYYY"));$("#endMission").val(moment(e.end).format("DD/MM/YYYY"));$("#ficheMission").val(e.fiche);$("#bgColorMission").val(e.bgColor);$("#divBgColorMission div").css("backgroundColor",e.bgColor);$("#txtColorMission").val(e.txtColor);$("#divTxtColorMission div").css("backgroundColor",e.txtColor);$("#lstFormation option[data-id='"+e.idFormation+"']").prop("selected",true);if(e.idSemestre=="1"){$("#lstModuleS1 option[data-id='"+e.idModule+"']").prop("selected",true);$("#divModSemestre2").prop("hidden",true)}if(e.idSemestre=="2"){$("#lstModuleS2 option[data-id='"+e.idModule+"']").prop("selected",true);$("#divModSemestre1").prop("hidden",true)}$("#lstSemestre option[data-id='"+e.idSemestre+"']").prop("selected",true);$("#idEvaluation").val(e.idEvaluation);$("#lstTypeEvaluation option[value='"+e.typeEvaluation+"']").prop("selected",true);$("#coefEvaluation").val(e.coefEvaluation);$("#dateEvaluation").val(moment(e.dateEvaluation).format("DD/MM/YYYY"));$.each(e.intervenants,function(e,t){if(t.idStatutIntervenant==2){$("#lstChargeTD option[value='"+t.nom+"']").prop("selected",true)}if(t.idStatutIntervenant==1){$("#lstEnseignant option[value='"+t.nom+"']").prop("selected",true)}});$("#missionContent").dialog({modal:true,title:e.title,width:500,height:500,buttons:false,close:function(){r();$("#modifier span").html("Modifier");$("#modifier, #deleteMission").show()}})})})}});$("#createMission").click(function(){n();$("#divModSemestre1, #divModSemestre2, #infoEvaluation").prop("hidden",true);$("#txtColorMission").val(i($("#divTxtColorMission div").css("backgroundColor")));$("#bgColorMission").val(i($("#divBgColorMission div").css("backgroundColor")));$("#btns").hide();$("#missionContent").dialog({height:500,width:500,modal:true,title:"Création d'une mission",buttons:{"Ajout mission":t,Annuler:function(){$("#missionContent").dialog("close");r();$("#btns").show()}},close:function(){r();$("#btns").show()}})});$("#lstSemestre").change(function(){if($("#lstSemestre option:selected").attr("data-id")=="1"){$("#divModSemestre1").prop("hidden",false);$("#divModSemestre2").prop("hidden",true)}else{if($("#lstSemestre option:selected").attr("data-id")=="2"){$("#divModSemestre2").prop("hidden",false);$("#divModSemestre1").prop("hidden",true)}else{$("#divModSemestre1, #divModSemestre2").prop("hidden",true)}}});$("#lstTypeEvaluation").change(function(){if($("#lstTypeEvaluation option:selected").attr("value")!=""){$("#infoEvaluation").prop("hidden",false)}else{$("#infoEvaluation").prop("hidden",true)}});$("#divBgColorMission").ColorPicker({color:"#333333",onShow:function(e){$(e).css("z-index","10000");$(e).fadeIn(250);return false},onHide:function(e){$(e).fadeOut(250);return false},onChange:function(e,t,n){$("#divBgColorMission div").css("backgroundColor","#"+t);$("#bgColorMission").val("#"+t)}});$("#divTxtColorMission").ColorPicker({color:"#ffffff",onShow:function(e){$(e).css("z-index","10000");$(e).fadeIn(250);return false},onHide:function(e){$(e).fadeOut(250);return false},onChange:function(e,t,n){$("#divTxtColorMission div").css("backgroundColor","#"+t);$("#txtColorMission").val("#"+t)}});$("#deleteMission").click(function(){$("#dialog-confirm").dialog({resizable:false,height:300,width:300,modal:true,buttons:{Supprimer:function(){$.ajax({url:"./deleteMission",data:"id="+$("#idMission").val(),type:"POST"}).done(function(){$("#dialog-confirm, #missionContent").dialog("close");$("#calendar").fullCalendar("refetchEvents")})},Annuler:function(){$(this).dialog("close")}}})});$("#modifier").click(function(){if($(this).children("span").text()=="Enregistrer"){if(s()){idEnseignant=null;idChargeTD=null;typeEvaluation=null;if($("#lstEnseignant option:selected").attr("data-id")!=null)idEnseignant=$("#lstEnseignant option:selected").attr("data-id");if($("#lstChargeTD option:selected").attr("data-id")!=null)idChargeTD=$("#lstChargeTD option:selected").attr("data-id");if($("#lstTypeEvaluation option:selected").val()!="")typeEvaluation=$("#lstTypeEvaluation option:selected").val();if($("#lstSemestre option:selected").attr("data-id")=="1")idModule=$("#lstModuleS1 option:selected").attr("data-id");if($("#lstSemestre option:selected").attr("data-id")=="2")idModule=$("#lstModuleS2 option:selected").attr("data-id");$.ajax({url:"./updateMission",data:"title="+$("#titleMission").val()+"&start="+$("#startMission").val().split("/").reverse().join("-")+"&end="+$("#endMission").val().split("/").reverse().join("-")+"&fiche="+$("#ficheMission").val()+"&bgColor="+$("#bgColorMission").val()+"&txtColor="+$("#txtColorMission").val()+"&idModule="+idModule+"&idFormation="+$("#lstFormation option:selected").attr("data-id")+"&typeEval="+typeEvaluation+"&coefEval="+$("#coefEvaluation").val()+"&dateEval="+$("#dateEvaluation").val().split("/").reverse().join("-")+"&idEnseignant="+idEnseignant+"&idChargeTD="+idChargeTD+"&id="+$("#idMission").val(),type:"POST"}).done(function(){location.reload()})}}if($(this).children("span").text()=="Modifier"){n();$("#modifier span").html("Enregistrer");$("#deleteMission").hide()}});$("#annuler").click(function(){$("#missionContent").dialog("close");r();$("#modifier span").html("Modifier");$("#modifier, #deleteMission").show()})})